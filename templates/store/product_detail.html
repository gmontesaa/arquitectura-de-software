{% extends 'base.html' %}
{% load i18n %}
{% block title %}{{ producto.nombre }} - Artesan√≠as{% endblock %}
{% block extra_head %}
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background-color: #fafafa; }
  .container { max-width: 1000px; margin: 0 auto; }
  .breadcrumbs { margin-bottom: 16px; font-size: 14px; color: #6c757d; }
  .breadcrumbs a { color: #2c5aa0; text-decoration: none; }
  .product-card { background: #fff; border: 1px solid #e5e5e5; border-radius: 10px; padding: 24px; display: grid; grid-template-columns: 1fr 1.2fr; gap: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
  .image-wrap { display: flex; align-items: center; justify-content: center; background: #f7f7f7; border-radius: 8px; min-height: 360px; }
  .image-wrap img { max-width: 100%; max-height: 400px; object-fit: contain; border-radius: 6px; }
  .no-image { width: 100%; height: 360px; display: flex; align-items: center; justify-content: center; color: #888; background: #f0f0f0; border-radius: 8px; font-size: 18px; }
  .title { margin: 0 0 6px 0; font-size: 28px; color: #212529; }
  .category { margin: 0 0 12px 0; color: #6c757d; font-size: 14px; }
  .price { font-size: 30px; color: #2c5aa0; font-weight: bold; margin: 10px 0 14px 0; }
  .stock-ok { color: #28a745; font-weight: bold; }
  .stock-bad { color: #dc3545; font-weight: bold; }
  .desc { color: #333; line-height: 1.6; white-space: pre-wrap; }
  .controls { margin-top: 18px; display: flex; gap: 10px; align-items: center; }
  .qty { width: 100px; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; }
  .btn { padding: 10px 18px; border: none; border-radius: 6px; cursor: pointer; }
  .btn-primary { background-color: #2c5aa0; color: #fff; }
  .btn-secondary { background-color: #6c757d; color: #fff; text-decoration: none; display: inline-block; }
  .card-footer { margin-top: 18px; }
</style>
{% endblock %}
{% block content %}
  <div class="breadcrumbs">
    {% if request.GET.next %}
      <a href="{{ request.GET.next }}">{% trans 'Cat√°logo' %}</a> / <span>{{ producto.nombre }}</span>
    {% else %}
      <a href="{% url 'product_list' %}">{% trans 'Cat√°logo' %}</a> / <span>{{ producto.nombre }}</span>
    {% endif %}
  </div>

  <div class="product-card">
    <div class="image-wrap">
      {% if producto.imagen %}
        <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" loading="lazy" width="600" height="400">
      {% else %}
        <div class="no-image">üì∑ Sin imagen</div>
      {% endif %}
    </div>
    <div>
      <h1 class="title">{{ producto.nombre }}</h1>
      {% if producto.categoria %}
        <div class="category">{% trans 'Categor√≠a' %}: {{ producto.categoria.nombre }}</div>
      {% endif %}
      <div class="price">${{ producto.precio }}</div>
      {% if producto.stock > 0 %}
        <div class="stock-ok">{% trans 'Stock' %}: {{ producto.stock }} {% trans 'unidades' %}</div>
      {% else %}
        <div class="stock-bad">{% trans 'Sin stock' %}</div>
      {% endif %}
      <div class="card-footer">
        {% if user.is_authenticated %}
          {% if producto.stock > 0 %}
            <form method="post" action="{% url 'add_to_cart' producto.pk %}">
              {% csrf_token %}
              <div class="controls">
                <input class="qty" type="number" name="cantidad" value="1" min="1" max="{{ producto.stock }}">
                <button type="submit" class="btn btn-primary">üõí {% trans 'A√±adir al carrito' %}</button>
                <a class="btn btn-secondary" href="{% url 'view_cart' %}{% if request.GET.next %}?next={{ request.GET.next|urlencode }}{% else %}?next={{ request.get_full_path|urlencode }}{% endif %}">{% trans 'Ver carrito' %}</a>
              </div>
            </form>
          {% else %}
            <div class="stock-bad">{% trans 'Este producto no est√° disponible actualmente.' %}</div>
          {% endif %}
        {% else %}
          <div style="margin-top:10px;">
            <a href="{% url 'login' %}" class="btn btn-primary">{% trans 'Inicia sesi√≥n para comprar' %}</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div style="background:#fff; border:1px solid #e5e5e5; border-radius: 10px; padding: 20px; margin-top: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.03);">
    <h2 style="margin-top:0; color:#212529;">{% trans 'Descripci√≥n' %}</h2>
    <p class="desc">{{ producto.descripcion }}</p>
  </div>

  {% if relacionados %}
  <div style="margin-top: 22px;">
    <h2 style="margin: 0 0 12px 0; color:#212529;">{% trans 'Tambi√©n te puede interesar' %}</h2>
    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 14px;">
      {% for r in relacionados %}
      <a href="{% url 'product_detail' r.pk %}{% if request.GET.next %}?next={{ request.GET.next|urlencode }}{% endif %}" style="text-decoration:none; color:inherit;">
        <div style="background:#fff; border:1px solid #e5e5e5; border-radius:10px; padding:14px; text-align:center; box-shadow: 0 2px 6px rgba(0,0,0,0.04);">
          {% if r.imagen %}
            <img src="{{ r.imagen.url }}" alt="{{ r.nombre }}" loading="lazy" width="160" height="160" style="max-width: 160px; max-height: 160px; object-fit: cover; border-radius:6px;">
          {% else %}
            <div style="width:160px; height:160px; background:#f0f0f0; display:flex; align-items:center; justify-content:center; color:#888; border-radius:6px; margin: 0 auto;">üì∑</div>
          {% endif %}
          <div style="font-weight:bold; margin-top:8px;">{{ r.nombre }}</div>
          <div style="color:#2c5aa0; font-weight:bold;">${{ r.precio }}</div>
        </div>
      </a>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <div style="margin-top: 20px;">
    {% if request.GET.next %}
      <a href="{{ request.GET.next }}" class="btn btn-secondary">‚Üê {% trans 'Volver al cat√°logo' %}</a>
    {% else %}
      <a href="{% url 'product_list' %}" class="btn btn-secondary">‚Üê {% trans 'Volver al cat√°logo' %}</a>
    {% endif %}
  </div>
</div>
{% endblock %}
