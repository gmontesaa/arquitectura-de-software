{% load static %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Artesanías{% endblock %}</title>
  <style>
    :root { --primary:#2c5aa0; --primary-dark:#1e3d6f; --success:#28a745; --danger:#dc3545; --muted:#6c757d; }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; font-family: Arial, sans-serif; background:#fafafa; color:#212529; }
    a { color: var(--primary); }
    .container { max-width: 1100px; margin: 0 auto; padding: 16px; }
    header { background:#fff; border-bottom:1px solid #e5e5e5; position: sticky; top:0; z-index: 10; }
    .nav { display:flex; align-items:center; justify-content: space-between; gap:12px; padding: 10px 0; }
    .brand { font-weight:bold; color: var(--primary); text-decoration:none; font-size: 18px; }
    .nav-links a { margin-left:12px; text-decoration:none; color:#212529; }
    .nav-links a:hover { color: var(--primary); }
    main { min-height: calc(100vh - 140px); }
    footer { background:#fff; border-top:1px solid #e5e5e5; padding: 16px 0; color:#666; }
    .btn { padding:10px 16px; border:none; border-radius:6px; cursor:pointer; display:inline-block; text-decoration:none; }
    .btn-primary { background: var(--primary); color:#fff; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-secondary { background: var(--muted); color:#fff; }
    .alert { padding:10px 12px; border-radius:6px; margin-bottom:10px; }
    .alert-success { background:#d4edda; color:#155724; }
    .alert-danger { background:#f8d7da; color:#721c24; }
    .alert-info { background:#d1ecf1; color:#0c5460; }
    .grid { display:grid; gap:16px; }
    @media (max-width: 768px) { .hide-mobile { display:none; } }
  </style>
  {% load i18n %}
  {% block extra_head %}{% endblock %}
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="{% url 'product_list' %}">Artesanías</a>
      <nav class="nav-links">
        <a href="{% url 'product_list' %}">{% trans 'Catálogo' %}</a>
        <a href="{% url 'view_cart' %}?next={{ request.get_full_path|urlencode }}">{% trans 'Carrito' %}</a>
        {% if user.is_authenticated %}
          <span class="hide-mobile">Hola, {{ user.username }}</span>
          <a href="{% url 'logout' %}">Salir</a>
        {% else %}
          <a href="{% url 'login' %}?next={{ request.get_full_path|urlencode }}">{% trans 'Ingresar' %}</a>
          <a href="{% url 'register' %}?next={{ request.get_full_path|urlencode }}">{% trans 'Crear cuenta' %}</a>
        {% endif %}
        <form id="langForm" action="{% url 'set_language' %}" method="post" style="display:inline-block; margin-left:10px;">
          {% csrf_token %}
          <input id="langNext" type="hidden" name="next" value="{{ request.get_full_path }}">
          <select id="langSelect" name="language">
            {% get_current_language as LANGUAGE_CODE %}
            {% get_available_languages as LANGUAGES %}
            {% for code, name in LANGUAGES %}
              <option value="{{ code }}" {% if code == LANGUAGE_CODE %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
          </select>
        </form>
      </nav>
    </div>
  </header>
  <main>
    <div class="container">
      {% if messages %}
        <div role="alert" aria-live="polite">
          {% for message in messages %}
            <div class="alert alert-info">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
      {% block content %}{% endblock %}
    </div>
  </main>
  <footer>
    <div class="container">
      <div>&copy; {{ now|default:"" }} Artesanías. Todos los derechos reservados.</div>
    </div>
  </footer>
  <script>
    (function(){
      var sel = document.getElementById('langSelect');
      var form = document.getElementById('langForm');
      var next = document.getElementById('langNext');
      if(sel && form && next){
        function buildNext(){
          var code = sel.value || 'es';
          var path = window.location.pathname + window.location.search;
          path = path.replace(/^\/(en|es)\//, '/');
          next.value = '/' + code + path;
        }
        buildNext();
        sel.addEventListener('change', function(){ buildNext(); form.submit(); });
      }
    })();
  </script>
  {% block extra_body %}{% endblock %}
</body>
</html>


